<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>UrbanEats â€“ Pillars + Store Symbols</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
  <style>
    body {margin:0;padding:0;font-family:Inter,Arial,sans-serif;}
    #map {position:absolute;top:0;bottom:0;width:100%;}
    .legend {
      position:absolute;top:10px;left:10px;background:#fff;padding:10px 12px;border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,.15);font-size:13px;z-index:1;
    }
    .row {display:flex;align-items:center;margin:4px 0;}
    .swatch {width:12px;height:12px;margin-right:8px;border-radius:2px;}
    .token {position:absolute;bottom:10px;left:10px;background:rgba(255,255,255,.9);padding:8px 10px;border-radius:6px;font-size:12px;z-index:1;}
  </style>
</head>
<body>
<div id="map"></div>
<div class="legend">
  <div><strong>Branches</strong></div>
  <div class="row"><span class="swatch" style="background:#c90b0b"></span>D2</div>
  <div class="row"><span class="swatch" style="background:#ff7f0e"></span>D14</div>
  <div class="row"><span class="swatch" style="background:#107710"></span>D10</div>
</div>
<!-- <div class="token">Replace <code>YOUR_MAPBOX_ACCESS_TOKEN</code> with your Mapbox token.</div> -->
<script>
  mapboxgl.accessToken = "pk.eyJ1IjoiZG9uZ21pbmg5NyIsImEiOiJjbG95bWNzangwNWpnMmlzMnBtYjV0cnI2In0.19dWe10xSPPwA_fwarIcJA"; // paste your token
  const pillars = {"type": "FeatureCollection", "features": [{"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.22419, 53.328197], [-6.22422066675634, 53.3284299371406], [-6.224310577136594, 53.328647000000004], [-6.224453603896932, 53.32883339610307], [-6.22464, 53.328976422863406], [-6.2248570628594075, 53.32906633324367], [-6.22509, 53.329097000000004], [-6.225322937140592, 53.32906633324367], [-6.22554, 53.328976422863406], [-6.2257263961030676, 53.32883339610307], [-6.225869422863406, 53.328647000000004], [-6.22595933324366, 53.3284299371406], [-6.2259899999999995, 53.328197], [-6.22595933324366, 53.32796406285941], [-6.225869422863406, 53.327747], [-6.2257263961030676, 53.327560603896934], [-6.22554, 53.3274175771366], [-6.225322937140592, 53.32732766675634], [-6.22509, 53.327297], [-6.2248570628594075, 53.32732766675634], [-6.22464, 53.3274175771366], [-6.224453603896932, 53.327560603896934], [-6.224310577136594, 53.327747], [-6.22422066675634, 53.32796406285941], [-6.22419, 53.328197]]]}, "properties": {"district": "4", "branch": "D10", "demand": 2258, "height": 160.53807978866647}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.22719, 53.328197], [-6.22722066675634, 53.3284299371406], [-6.227310577136594, 53.328647000000004], [-6.227453603896932, 53.32883339610307], [-6.22764, 53.328976422863406], [-6.227857062859408, 53.32906633324367], [-6.22809, 53.329097000000004], [-6.228322937140592, 53.32906633324367], [-6.22854, 53.328976422863406], [-6.228726396103068, 53.32883339610307], [-6.228869422863406, 53.328647000000004], [-6.22895933324366, 53.3284299371406], [-6.22899, 53.328197], [-6.22895933324366, 53.32796406285941], [-6.228869422863406, 53.327747], [-6.228726396103068, 53.327560603896934], [-6.22854, 53.3274175771366], [-6.228322937140592, 53.32732766675634], [-6.22809, 53.327297], [-6.227857062859408, 53.32732766675634], [-6.22764, 53.3274175771366], [-6.227453603896932, 53.327560603896934], [-6.227310577136594, 53.327747], [-6.22722066675634, 53.32796406285941], [-6.22719, 53.328197]]]}, "properties": {"district": "4", "branch": "D14", "demand": 12733, "height": 348.5967094548672}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.23019, 53.328197], [-6.23022066675634, 53.3284299371406], [-6.230310577136594, 53.328647000000004], [-6.230453603896932, 53.32883339610307], [-6.23064, 53.328976422863406], [-6.230857062859408, 53.32906633324367], [-6.23109, 53.329097000000004], [-6.231322937140592, 53.32906633324367], [-6.23154, 53.328976422863406], [-6.231726396103068, 53.32883339610307], [-6.231869422863406, 53.328647000000004], [-6.23195933324366, 53.3284299371406], [-6.23199, 53.328197], [-6.23195933324366, 53.32796406285941], [-6.231869422863406, 53.327747], [-6.231726396103068, 53.327560603896934], [-6.23154, 53.3274175771366], [-6.231322937140592, 53.32732766675634], [-6.23109, 53.327297], [-6.230857062859408, 53.32732766675634], [-6.23064, 53.3274175771366], [-6.230453603896932, 53.327560603896934], [-6.230310577136594, 53.327747], [-6.23022066675634, 53.32796406285941], [-6.23019, 53.328197]]]}, "properties": {"district": "4", "branch": "D2", "demand": 70397, "height": 1383.8437568125569}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.260449, 53.321452], [-6.26047966675634, 53.321684937140596], [-6.260569577136594, 53.321902], [-6.260712603896932, 53.32208839610307], [-6.260899, 53.3222314228634], [-6.261116062859408, 53.322321333243664], [-6.261349, 53.322352], [-6.261581937140592, 53.322321333243664], [-6.261799, 53.3222314228634], [-6.261985396103068, 53.32208839610307], [-6.262128422863406, 53.321902], [-6.26221833324366, 53.321684937140596], [-6.262249, 53.321452], [-6.26221833324366, 53.321219062859406], [-6.262128422863406, 53.321002], [-6.261985396103068, 53.32081560389693], [-6.261799, 53.3206725771366], [-6.261581937140592, 53.32058266675634], [-6.261349, 53.320552], [-6.261116062859408, 53.32058266675634], [-6.260899, 53.3206725771366], [-6.260712603896932, 53.32081560389693], [-6.260569577136594, 53.321002], [-6.26047966675634, 53.321219062859406], [-6.260449, 53.321452]]]}, "properties": {"district": "6", "branch": "D10", "demand": 5510, "height": 218.92153216809223}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.2634490000000005, 53.321452], [-6.26347966675634, 53.321684937140596], [-6.263569577136594, 53.321902], [-6.263712603896932, 53.32208839610307], [-6.263899, 53.3222314228634], [-6.264116062859408, 53.322321333243664], [-6.264349, 53.322352], [-6.264581937140592, 53.322321333243664], [-6.264799, 53.3222314228634], [-6.264985396103068, 53.32208839610307], [-6.265128422863406, 53.321902], [-6.26521833324366, 53.321684937140596], [-6.265249, 53.321452], [-6.26521833324366, 53.321219062859406], [-6.265128422863406, 53.321002], [-6.264985396103068, 53.32081560389693], [-6.264799, 53.3206725771366], [-6.264581937140592, 53.32058266675634], [-6.264349, 53.320552], [-6.264116062859408, 53.32058266675634], [-6.263899, 53.3206725771366], [-6.263712603896932, 53.32081560389693], [-6.263569577136594, 53.321002], [-6.26347966675634, 53.321219062859406], [-6.2634490000000005, 53.321452]]]}, "properties": {"district": "6", "branch": "D14", "demand": 12712, "height": 348.2196945409779}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.266449000000001, 53.321452], [-6.26647966675634, 53.321684937140596], [-6.266569577136594, 53.321902], [-6.2667126038969325, 53.32208839610307], [-6.266899, 53.3222314228634], [-6.267116062859408, 53.322321333243664], [-6.267349, 53.322352], [-6.2675819371405925, 53.322321333243664], [-6.267799, 53.3222314228634], [-6.267985396103068, 53.32208839610307], [-6.268128422863406, 53.321902], [-6.26821833324366, 53.321684937140596], [-6.268249, 53.321452], [-6.26821833324366, 53.321219062859406], [-6.268128422863406, 53.321002], [-6.267985396103068, 53.32081560389693], [-6.267799, 53.3206725771366], [-6.2675819371405925, 53.32058266675634], [-6.267349, 53.320552], [-6.267116062859408, 53.32058266675634], [-6.266899, 53.3206725771366], [-6.2667126038969325, 53.32081560389693], [-6.266569577136594, 53.321002], [-6.26647966675634, 53.321219062859406], [-6.266449000000001, 53.321452]]]}, "properties": {"district": "6", "branch": "D2", "demand": 48924, "height": 998.3370308151985}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.313448, 53.34197], [-6.31347866675634, 53.3422029371406], [-6.313568577136594, 53.342420000000004], [-6.313711603896932, 53.34260639610307], [-6.313898, 53.342749422863406], [-6.314115062859408, 53.34283933324367], [-6.314348, 53.342870000000005], [-6.314580937140592, 53.34283933324367], [-6.314798, 53.342749422863406], [-6.314984396103068, 53.34260639610307], [-6.315127422863406, 53.342420000000004], [-6.31521733324366, 53.3422029371406], [-6.3152479999999995, 53.34197], [-6.31521733324366, 53.34173706285941], [-6.315127422863406, 53.34152], [-6.314984396103068, 53.341333603896935], [-6.314798, 53.3411905771366], [-6.314580937140592, 53.34110066675634], [-6.314348, 53.34107], [-6.314115062859408, 53.34110066675634], [-6.313898, 53.3411905771366], [-6.313711603896932, 53.341333603896935], [-6.313568577136594, 53.34152], [-6.31347866675634, 53.34173706285941], [-6.313448, 53.34197]]]}, "properties": {"district": "8", "branch": "D10", "demand": 19935, "height": 477.8948718277529}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.316448, 53.34197], [-6.31647866675634, 53.3422029371406], [-6.316568577136594, 53.342420000000004], [-6.316711603896932, 53.34260639610307], [-6.316898, 53.342749422863406], [-6.317115062859408, 53.34283933324367], [-6.317348, 53.342870000000005], [-6.317580937140592, 53.34283933324367], [-6.317798, 53.342749422863406], [-6.317984396103068, 53.34260639610307], [-6.318127422863406, 53.342420000000004], [-6.31821733324366, 53.3422029371406], [-6.318248, 53.34197], [-6.31821733324366, 53.34173706285941], [-6.318127422863406, 53.34152], [-6.317984396103068, 53.341333603896935], [-6.317798, 53.3411905771366], [-6.317580937140592, 53.34110066675634], [-6.317348, 53.34107], [-6.317115062859408, 53.34110066675634], [-6.316898, 53.3411905771366], [-6.316711603896932, 53.341333603896935], [-6.316568577136594, 53.34152], [-6.31647866675634, 53.34173706285941], [-6.316448, 53.34197]]]}, "properties": {"district": "8", "branch": "D14", "demand": 10047, "height": 300.3747066593145}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.319448, 53.34197], [-6.31947866675634, 53.3422029371406], [-6.319568577136594, 53.342420000000004], [-6.319711603896932, 53.34260639610307], [-6.319898, 53.342749422863406], [-6.320115062859408, 53.34283933324367], [-6.320348, 53.342870000000005], [-6.320580937140592, 53.34283933324367], [-6.320798, 53.342749422863406], [-6.320984396103068, 53.34260639610307], [-6.321127422863406, 53.342420000000004], [-6.32121733324366, 53.3422029371406], [-6.321248, 53.34197], [-6.32121733324366, 53.34173706285941], [-6.321127422863406, 53.34152], [-6.320984396103068, 53.341333603896935], [-6.320798, 53.3411905771366], [-6.320580937140592, 53.34110066675634], [-6.320348, 53.34107], [-6.320115062859408, 53.34110066675634], [-6.319898, 53.3411905771366], [-6.319711603896932, 53.341333603896935], [-6.319568577136594, 53.34152], [-6.31947866675634, 53.34173706285941], [-6.319448, 53.34197]]]}, "properties": {"district": "8", "branch": "D2", "demand": 77981, "height": 1520.0}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.313419000000001, 53.321125], [-6.31344966675634, 53.3213579371406], [-6.313539577136594, 53.321575], [-6.3136826038969325, 53.32176139610307], [-6.313869, 53.321904422863405], [-6.314086062859408, 53.321994333243666], [-6.314319, 53.322025000000004], [-6.3145519371405925, 53.321994333243666], [-6.314769, 53.321904422863405], [-6.314955396103068, 53.32176139610307], [-6.315098422863406, 53.321575], [-6.31518833324366, 53.3213579371406], [-6.315219, 53.321125], [-6.31518833324366, 53.32089206285941], [-6.315098422863406, 53.320675], [-6.314955396103068, 53.32048860389693], [-6.314769, 53.3203455771366], [-6.3145519371405925, 53.32025566675634], [-6.314319, 53.320225], [-6.314086062859408, 53.32025566675634], [-6.313869, 53.3203455771366], [-6.3136826038969325, 53.32048860389693], [-6.313539577136594, 53.320675], [-6.31344966675634, 53.32089206285941], [-6.313419000000001, 53.321125]]]}, "properties": {"district": "12", "branch": "D10", "demand": 21680, "height": 509.22301586283834}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.316419000000001, 53.321125], [-6.31644966675634, 53.3213579371406], [-6.316539577136594, 53.321575], [-6.316682603896933, 53.32176139610307], [-6.3168690000000005, 53.321904422863405], [-6.317086062859408, 53.321994333243666], [-6.317319, 53.322025000000004], [-6.317551937140593, 53.321994333243666], [-6.317769, 53.321904422863405], [-6.317955396103068, 53.32176139610307], [-6.3180984228634065, 53.321575], [-6.31818833324366, 53.3213579371406], [-6.318219, 53.321125], [-6.31818833324366, 53.32089206285941], [-6.3180984228634065, 53.320675], [-6.317955396103068, 53.32048860389693], [-6.317769, 53.3203455771366], [-6.317551937140593, 53.32025566675634], [-6.317319, 53.320225], [-6.317086062859408, 53.32025566675634], [-6.3168690000000005, 53.3203455771366], [-6.316682603896933, 53.32048860389693], [-6.316539577136594, 53.320675], [-6.31644966675634, 53.32089206285941], [-6.316419000000001, 53.321125]]]}, "properties": {"district": "12", "branch": "D14", "demand": 10185, "height": 302.8522332363011}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.319419000000001, 53.321125], [-6.3194496667563405, 53.3213579371406], [-6.319539577136594, 53.321575], [-6.319682603896933, 53.32176139610307], [-6.319869000000001, 53.321904422863405], [-6.320086062859408, 53.321994333243666], [-6.3203190000000005, 53.322025000000004], [-6.320551937140593, 53.321994333243666], [-6.320769, 53.321904422863405], [-6.320955396103068, 53.32176139610307], [-6.321098422863407, 53.321575], [-6.3211883332436605, 53.3213579371406], [-6.321219, 53.321125], [-6.3211883332436605, 53.32089206285941], [-6.321098422863407, 53.320675], [-6.320955396103068, 53.32048860389693], [-6.320769, 53.3203455771366], [-6.320551937140593, 53.32025566675634], [-6.3203190000000005, 53.320225], [-6.320086062859408, 53.32025566675634], [-6.319869000000001, 53.3203455771366], [-6.319682603896933, 53.32048860389693], [-6.319539577136594, 53.320675], [-6.3194496667563405, 53.32089206285941], [-6.319419000000001, 53.321125]]]}, "properties": {"district": "12", "branch": "D2", "demand": 49554, "height": 1009.6474782318769}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.281027, 53.281712], [-6.28105766675634, 53.281944937140594], [-6.281147577136593, 53.282162], [-6.281290603896932, 53.28234839610307], [-6.281477, 53.2824914228634], [-6.281694062859407, 53.28258133324366], [-6.281927, 53.282612], [-6.282159937140592, 53.28258133324366], [-6.282376999999999, 53.2824914228634], [-6.282563396103067, 53.28234839610307], [-6.282706422863406, 53.282162], [-6.28279633324366, 53.281944937140594], [-6.282826999999999, 53.281712], [-6.28279633324366, 53.281479062859404], [-6.282706422863406, 53.281262], [-6.282563396103067, 53.28107560389693], [-6.282376999999999, 53.280932577136596], [-6.282159937140592, 53.280842666756335], [-6.281927, 53.280812], [-6.281694062859407, 53.280842666756335], [-6.281477, 53.280932577136596], [-6.281290603896932, 53.28107560389693], [-6.281147577136593, 53.281262], [-6.28105766675634, 53.281479062859404], [-6.281027, 53.281712]]]}, "properties": {"district": "16", "branch": "D10", "demand": 8645, "height": 275.20447288442057}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.284027, 53.281712], [-6.28405766675634, 53.281944937140594], [-6.2841475771365936, 53.282162], [-6.284290603896932, 53.28234839610307], [-6.284477, 53.2824914228634], [-6.2846940628594075, 53.28258133324366], [-6.284927, 53.282612], [-6.285159937140592, 53.28258133324366], [-6.2853769999999995, 53.2824914228634], [-6.2855633961030675, 53.28234839610307], [-6.285706422863406, 53.282162], [-6.28579633324366, 53.281944937140594], [-6.285826999999999, 53.281712], [-6.28579633324366, 53.281479062859404], [-6.285706422863406, 53.281262], [-6.2855633961030675, 53.28107560389693], [-6.2853769999999995, 53.280932577136596], [-6.285159937140592, 53.280842666756335], [-6.284927, 53.280812], [-6.2846940628594075, 53.280842666756335], [-6.284477, 53.280932577136596], [-6.284290603896932, 53.28107560389693], [-6.2841475771365936, 53.281262], [-6.28405766675634, 53.281479062859404], [-6.284027, 53.281712]]]}, "properties": {"district": "16", "branch": "D14", "demand": 64336, "height": 1275.0300714276555}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.287027, 53.281712], [-6.28705766675634, 53.281944937140594], [-6.287147577136594, 53.282162], [-6.287290603896932, 53.28234839610307], [-6.287477, 53.2824914228634], [-6.287694062859408, 53.28258133324366], [-6.287927, 53.282612], [-6.288159937140592, 53.28258133324366], [-6.288377, 53.2824914228634], [-6.288563396103068, 53.28234839610307], [-6.288706422863406, 53.282162], [-6.28879633324366, 53.281944937140594], [-6.2888269999999995, 53.281712], [-6.28879633324366, 53.281479062859404], [-6.288706422863406, 53.281262], [-6.288563396103068, 53.28107560389693], [-6.288377, 53.280932577136596], [-6.288159937140592, 53.280842666756335], [-6.287927, 53.280812], [-6.287694062859408, 53.280842666756335], [-6.287477, 53.280932577136596], [-6.287290603896932, 53.28107560389693], [-6.287147577136594, 53.281262], [-6.28705766675634, 53.281479062859404], [-6.287027, 53.281712]]]}, "properties": {"district": "16", "branch": "D2", "demand": 7151, "height": 248.38255472486887}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.149365, 53.263568], [-6.14939566675634, 53.263800937140594], [-6.149485577136594, 53.264018], [-6.149628603896932, 53.26420439610307], [-6.149815, 53.2643474228634], [-6.150032062859408, 53.26443733324366], [-6.150265, 53.264468], [-6.150497937140592, 53.26443733324366], [-6.150715, 53.2643474228634], [-6.150901396103068, 53.26420439610307], [-6.151044422863406, 53.264018], [-6.15113433324366, 53.263800937140594], [-6.151165, 53.263568], [-6.15113433324366, 53.263335062859404], [-6.151044422863406, 53.263118], [-6.150901396103068, 53.26293160389693], [-6.150715, 53.2627885771366], [-6.150497937140592, 53.262698666756336], [-6.150265, 53.262668], [-6.150032062859408, 53.262698666756336], [-6.149815, 53.2627885771366], [-6.149628603896932, 53.26293160389693], [-6.149485577136594, 53.263118], [-6.14939566675634, 53.263335062859404], [-6.149365, 53.263568]]]}, "properties": {"district": "18", "branch": "D10", "demand": 2237, "height": 160.1610648747772}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.1523650000000005, 53.263568], [-6.15239566675634, 53.263800937140594], [-6.152485577136594, 53.264018], [-6.1526286038969324, 53.26420439610307], [-6.152815, 53.2643474228634], [-6.153032062859408, 53.26443733324366], [-6.153265, 53.264468], [-6.1534979371405925, 53.26443733324366], [-6.153715, 53.2643474228634], [-6.153901396103068, 53.26420439610307], [-6.154044422863406, 53.264018], [-6.15413433324366, 53.263800937140594], [-6.154165, 53.263568], [-6.15413433324366, 53.263335062859404], [-6.154044422863406, 53.263118], [-6.153901396103068, 53.26293160389693], [-6.153715, 53.2627885771366], [-6.1534979371405925, 53.262698666756336], [-6.153265, 53.262668], [-6.153032062859408, 53.262698666756336], [-6.152815, 53.2627885771366], [-6.1526286038969324, 53.26293160389693], [-6.152485577136594, 53.263118], [-6.15239566675634, 53.263335062859404], [-6.1523650000000005, 53.263568]]]}, "properties": {"district": "18", "branch": "D14", "demand": 76536, "height": 1494.05778330619}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.155365000000001, 53.263568], [-6.15539566675634, 53.263800937140594], [-6.155485577136594, 53.264018], [-6.155628603896933, 53.26420439610307], [-6.1558150000000005, 53.2643474228634], [-6.156032062859408, 53.26443733324366], [-6.156265, 53.264468], [-6.156497937140593, 53.26443733324366], [-6.156715, 53.2643474228634], [-6.156901396103068, 53.26420439610307], [-6.1570444228634065, 53.264018], [-6.15713433324366, 53.263800937140594], [-6.157165, 53.263568], [-6.15713433324366, 53.263335062859404], [-6.1570444228634065, 53.263118], [-6.156901396103068, 53.26293160389693], [-6.156715, 53.2627885771366], [-6.156497937140593, 53.262698666756336], [-6.156265, 53.262668], [-6.156032062859408, 53.262698666756336], [-6.1558150000000005, 53.2627885771366], [-6.155628603896933, 53.26293160389693], [-6.155485577136594, 53.263118], [-6.15539566675634, 53.263335062859404], [-6.155365000000001, 53.263568]]]}, "properties": {"district": "18", "branch": "D2", "demand": 3540, "height": 183.55394262705016}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.364641, 53.350928], [-6.364671666756339, 53.3511609371406], [-6.364761577136593, 53.351378000000004], [-6.364904603896932, 53.35156439610307], [-6.365091, 53.351707422863406], [-6.365308062859407, 53.35179733324367], [-6.3655409999999994, 53.351828000000005], [-6.365773937140592, 53.35179733324367], [-6.365990999999999, 53.351707422863406], [-6.366177396103067, 53.35156439610307], [-6.366320422863406, 53.351378000000004], [-6.3664103332436595, 53.3511609371406], [-6.366440999999999, 53.350928], [-6.3664103332436595, 53.35069506285941], [-6.366320422863406, 53.350478], [-6.366177396103067, 53.350291603896935], [-6.365990999999999, 53.3501485771366], [-6.365773937140592, 53.35005866675634], [-6.3655409999999994, 53.350028], [-6.365308062859407, 53.35005866675634], [-6.365091, 53.3501485771366], [-6.364904603896932, 53.350291603896935], [-6.364761577136593, 53.350478], [-6.364671666756339, 53.35069506285941], [-6.364641, 53.350928]]]}, "properties": {"district": "20", "branch": "D10", "demand": 65797, "height": 1301.2595375796668}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.367641, 53.350928], [-6.3676716667563396, 53.3511609371406], [-6.367761577136593, 53.351378000000004], [-6.367904603896932, 53.35156439610307], [-6.368091, 53.351707422863406], [-6.368308062859407, 53.35179733324367], [-6.368541, 53.351828000000005], [-6.368773937140592, 53.35179733324367], [-6.368990999999999, 53.351707422863406], [-6.369177396103067, 53.35156439610307], [-6.369320422863406, 53.351378000000004], [-6.36941033324366, 53.3511609371406], [-6.369440999999999, 53.350928], [-6.36941033324366, 53.35069506285941], [-6.369320422863406, 53.350478], [-6.369177396103067, 53.350291603896935], [-6.368990999999999, 53.3501485771366], [-6.368773937140592, 53.35005866675634], [-6.368541, 53.350028], [-6.368308062859407, 53.35005866675634], [-6.368091, 53.3501485771366], [-6.367904603896932, 53.350291603896935], [-6.367761577136593, 53.350478], [-6.3676716667563396, 53.35069506285941], [-6.367641, 53.350928]]]}, "properties": {"district": "20", "branch": "D14", "demand": 2572, "height": 166.1753504058681}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.370641, 53.350928], [-6.37067166675634, 53.3511609371406], [-6.3707615771365935, 53.351378000000004], [-6.370904603896932, 53.35156439610307], [-6.371091, 53.351707422863406], [-6.371308062859407, 53.35179733324367], [-6.371541, 53.351828000000005], [-6.371773937140592, 53.35179733324367], [-6.3719909999999995, 53.351707422863406], [-6.372177396103067, 53.35156439610307], [-6.372320422863406, 53.351378000000004], [-6.37241033324366, 53.3511609371406], [-6.372440999999999, 53.350928], [-6.37241033324366, 53.35069506285941], [-6.372320422863406, 53.350478], [-6.372177396103067, 53.350291603896935], [-6.3719909999999995, 53.3501485771366], [-6.371773937140592, 53.35005866675634], [-6.371541, 53.350028], [-6.371308062859407, 53.35005866675634], [-6.371091, 53.3501485771366], [-6.370904603896932, 53.350291603896935], [-6.3707615771365935, 53.350478], [-6.37067166675634, 53.35069506285941], [-6.370641, 53.350928]]]}, "properties": {"district": "20", "branch": "D2", "demand": 31655, "height": 688.3050999602467}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.393631, 53.317868], [-6.39366166675634, 53.31810093714059], [-6.393751577136594, 53.318318], [-6.393894603896932, 53.318504396103066], [-6.394081, 53.3186474228634], [-6.3942980628594075, 53.31873733324366], [-6.394531, 53.318768], [-6.394763937140592, 53.31873733324366], [-6.394981, 53.3186474228634], [-6.3951673961030675, 53.318504396103066], [-6.395310422863406, 53.318318], [-6.39540033324366, 53.31810093714059], [-6.395430999999999, 53.317868], [-6.39540033324366, 53.3176350628594], [-6.395310422863406, 53.317417999999996], [-6.3951673961030675, 53.31723160389693], [-6.394981, 53.317088577136595], [-6.394763937140592, 53.316998666756334], [-6.394531, 53.316967999999996], [-6.3942980628594075, 53.316998666756334], [-6.394081, 53.317088577136595], [-6.393894603896932, 53.31723160389693], [-6.393751577136594, 53.317417999999996], [-6.39366166675634, 53.3176350628594], [-6.393631, 53.317868]]]}, "properties": {"district": "22", "branch": "D10", "demand": 54379, "height": 1096.2711429707235}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.396631, 53.317868], [-6.39666166675634, 53.31810093714059], [-6.396751577136594, 53.318318], [-6.396894603896932, 53.318504396103066], [-6.397081, 53.3186474228634], [-6.397298062859408, 53.31873733324366], [-6.397531, 53.318768], [-6.397763937140592, 53.31873733324366], [-6.397981, 53.3186474228634], [-6.398167396103068, 53.318504396103066], [-6.398310422863406, 53.318318], [-6.39840033324366, 53.31810093714059], [-6.3984309999999995, 53.317868], [-6.39840033324366, 53.3176350628594], [-6.398310422863406, 53.317417999999996], [-6.398167396103068, 53.31723160389693], [-6.397981, 53.317088577136595], [-6.397763937140592, 53.316998666756334], [-6.397531, 53.316967999999996], [-6.397298062859408, 53.316998666756334], [-6.397081, 53.317088577136595], [-6.396894603896932, 53.31723160389693], [-6.396751577136594, 53.317417999999996], [-6.39666166675634, 53.3176350628594], [-6.396631, 53.317868]]]}, "properties": {"district": "22", "branch": "D14", "demand": 7720, "height": 258.5978635821547}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.399631, 53.317868], [-6.39966166675634, 53.31810093714059], [-6.399751577136594, 53.318318], [-6.399894603896932, 53.318504396103066], [-6.400081, 53.3186474228634], [-6.400298062859408, 53.31873733324366], [-6.400531, 53.318768], [-6.400763937140592, 53.31873733324366], [-6.400981, 53.3186474228634], [-6.401167396103068, 53.318504396103066], [-6.401310422863406, 53.318318], [-6.40140033324366, 53.31810093714059], [-6.401431, 53.317868], [-6.40140033324366, 53.3176350628594], [-6.401310422863406, 53.317417999999996], [-6.401167396103068, 53.31723160389693], [-6.400981, 53.317088577136595], [-6.400763937140592, 53.316998666756334], [-6.400531, 53.316967999999996], [-6.400298062859408, 53.316998666756334], [-6.400081, 53.317088577136595], [-6.399894603896932, 53.31723160389693], [-6.399751577136594, 53.317417999999996], [-6.39966166675634, 53.3176350628594], [-6.399631, 53.317868]]]}, "properties": {"district": "22", "branch": "D2", "demand": 14024, "height": 371.7741501134892}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.3680200000000005, 53.285009], [-6.36805066675634, 53.2852419371406], [-6.368140577136594, 53.285459], [-6.368283603896932, 53.28564539610307], [-6.36847, 53.285788422863405], [-6.368687062859408, 53.285878333243666], [-6.36892, 53.285909000000004], [-6.369152937140592, 53.285878333243666], [-6.36937, 53.285788422863405], [-6.369556396103068, 53.28564539610307], [-6.369699422863406, 53.285459], [-6.36978933324366, 53.2852419371406], [-6.36982, 53.285009], [-6.36978933324366, 53.28477606285941], [-6.369699422863406, 53.284559], [-6.369556396103068, 53.284372603896934], [-6.36937, 53.2842295771366], [-6.369152937140592, 53.28413966675634], [-6.36892, 53.284109], [-6.368687062859408, 53.28413966675634], [-6.36847, 53.2842295771366], [-6.368283603896932, 53.284372603896934], [-6.368140577136594, 53.284559], [-6.36805066675634, 53.28477606285941], [-6.3680200000000005, 53.285009]]]}, "properties": {"district": "24", "branch": "D10", "demand": 32858, "height": 709.9026685987612}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.371020000000001, 53.285009], [-6.37105066675634, 53.2852419371406], [-6.371140577136594, 53.285459], [-6.3712836038969325, 53.28564539610307], [-6.37147, 53.285788422863405], [-6.371687062859408, 53.285878333243666], [-6.37192, 53.285909000000004], [-6.3721529371405925, 53.285878333243666], [-6.37237, 53.285788422863405], [-6.372556396103068, 53.28564539610307], [-6.372699422863406, 53.285459], [-6.37278933324366, 53.2852419371406], [-6.37282, 53.285009], [-6.37278933324366, 53.28477606285941], [-6.372699422863406, 53.284559], [-6.372556396103068, 53.284372603896934], [-6.37237, 53.2842295771366], [-6.3721529371405925, 53.28413966675634], [-6.37192, 53.284109], [-6.371687062859408, 53.28413966675634], [-6.37147, 53.2842295771366], [-6.3712836038969325, 53.284372603896934], [-6.371140577136594, 53.284559], [-6.37105066675634, 53.28477606285941], [-6.371020000000001, 53.285009]]]}, "properties": {"district": "24", "branch": "D14", "demand": 38312, "height": 807.8188276631487}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.374020000000001, 53.285009], [-6.37405066675634, 53.2852419371406], [-6.374140577136594, 53.285459], [-6.374283603896933, 53.28564539610307], [-6.3744700000000005, 53.285788422863405], [-6.374687062859408, 53.285878333243666], [-6.37492, 53.285909000000004], [-6.375152937140593, 53.285878333243666], [-6.37537, 53.285788422863405], [-6.375556396103068, 53.28564539610307], [-6.3756994228634065, 53.285459], [-6.37578933324366, 53.2852419371406], [-6.37582, 53.285009], [-6.37578933324366, 53.28477606285941], [-6.3756994228634065, 53.284559], [-6.375556396103068, 53.284372603896934], [-6.37537, 53.2842295771366], [-6.375152937140593, 53.28413966675634], [-6.37492, 53.284109], [-6.374687062859408, 53.28413966675634], [-6.3744700000000005, 53.2842295771366], [-6.374283603896933, 53.284372603896934], [-6.374140577136594, 53.284559], [-6.37405066675634, 53.28477606285941], [-6.374020000000001, 53.285009]]]}, "properties": {"district": "24", "branch": "D2", "demand": 7055, "height": 246.65905797566074}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.297988, 53.308329], [-6.29801866675634, 53.308561937140595], [-6.298108577136594, 53.308779], [-6.298251603896932, 53.30896539610307], [-6.298438, 53.3091084228634], [-6.298655062859408, 53.309198333243664], [-6.298888, 53.309229], [-6.299120937140592, 53.309198333243664], [-6.299338, 53.3091084228634], [-6.299524396103068, 53.30896539610307], [-6.299667422863406, 53.308779], [-6.29975733324366, 53.308561937140595], [-6.2997879999999995, 53.308329], [-6.29975733324366, 53.308096062859406], [-6.299667422863406, 53.307879], [-6.299524396103068, 53.30769260389693], [-6.299338, 53.3075495771366], [-6.299120937140592, 53.30745966675634], [-6.298888, 53.307429], [-6.298655062859408, 53.30745966675634], [-6.298438, 53.3075495771366], [-6.298251603896932, 53.30769260389693], [-6.298108577136594, 53.307879], [-6.29801866675634, 53.308096062859406], [-6.297988, 53.308329]]]}, "properties": {"district": "6w", "branch": "D10", "demand": 5356, "height": 216.15675613290418}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.300988, 53.308329], [-6.30101866675634, 53.308561937140595], [-6.301108577136594, 53.308779], [-6.301251603896932, 53.30896539610307], [-6.301438, 53.3091084228634], [-6.301655062859408, 53.309198333243664], [-6.301888, 53.309229], [-6.302120937140592, 53.309198333243664], [-6.302338, 53.3091084228634], [-6.302524396103068, 53.30896539610307], [-6.302667422863406, 53.308779], [-6.30275733324366, 53.308561937140595], [-6.302788, 53.308329], [-6.30275733324366, 53.308096062859406], [-6.302667422863406, 53.307879], [-6.302524396103068, 53.30769260389693], [-6.302338, 53.3075495771366], [-6.302120937140592, 53.30745966675634], [-6.301888, 53.307429], [-6.301655062859408, 53.30745966675634], [-6.301438, 53.3075495771366], [-6.301251603896932, 53.30769260389693], [-6.301108577136594, 53.307879], [-6.30101866675634, 53.308096062859406], [-6.300988, 53.308329]]]}, "properties": {"district": "6w", "branch": "D14", "demand": 20440, "height": 486.96118285223326}}, {"type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-6.303988, 53.308329], [-6.30401866675634, 53.308561937140595], [-6.304108577136594, 53.308779], [-6.304251603896932, 53.30896539610307], [-6.304438, 53.3091084228634], [-6.304655062859408, 53.309198333243664], [-6.304888, 53.309229], [-6.305120937140592, 53.309198333243664], [-6.305338, 53.3091084228634], [-6.305524396103068, 53.30896539610307], [-6.305667422863406, 53.308779], [-6.30575733324366, 53.308561937140595], [-6.305788, 53.308329], [-6.30575733324366, 53.308096062859406], [-6.305667422863406, 53.307879], [-6.305524396103068, 53.30769260389693], [-6.305338, 53.3075495771366], [-6.305120937140592, 53.30745966675634], [-6.304888, 53.307429], [-6.304655062859408, 53.30745966675634], [-6.304438, 53.3075495771366], [-6.304251603896932, 53.30769260389693], [-6.304108577136594, 53.307879], [-6.30401866675634, 53.308096062859406], [-6.303988, 53.308329]]]}, "properties": {"district": "6w", "branch": "D2", "demand": 42062, "height": 875.1429194290918}}]};
  const labels = {"type": "FeatureCollection", "features": [{"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.22809, 53.328197]}, "properties": {"district": "4"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.264349, 53.321452]}, "properties": {"district": "6"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.317348, 53.34197]}, "properties": {"district": "8"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.317319, 53.321125]}, "properties": {"district": "12"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.284927, 53.281712]}, "properties": {"district": "16"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.153265, 53.263568]}, "properties": {"district": "18"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.368541, 53.350928]}, "properties": {"district": "20"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.397531, 53.317868]}, "properties": {"district": "22"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.37192, 53.285009]}, "properties": {"district": "24"}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.301888, 53.308329]}, "properties": {"district": "6w"}}]};
  const stores = {"type": "FeatureCollection", "features": [{"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.355295493558344, 53.32337711273925]}, "properties": {"branch": "D10", "label": "D10 Restaurant", "total_demand": 218655}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.262850445329097, 53.28892169176777]}, "properties": {"branch": "D14", "label": "D14 Restaurant", "total_demand": 255593}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-6.296882646035256, 53.32611581746763]}, "properties": {"branch": "D2", "label": "D2 Restaurant", "total_demand": 352343}}]};

  const map = new mapboxgl.Map({
    container:"map",
    style:"mapbox://styles/mapbox/light-v11",
    center:[-6.25, 53.31],
    zoom:11.2,
    pitch:55,
    bearing:-17,
    antialias:true
  });

  map.on("load", () => {
    map.addSource("pillars", {type:"geojson", data:pillars});
    map.addLayer({
      id:"pillars-layer",
      type:"fill-extrusion",
      source:"pillars",
      paint:{
        "fill-extrusion-color":[
          "match",
          ["get","branch"],
          "D2", "#c90b0b", "D14", "#ff7f0e", "D10", "#107710",
          "#888"
        ],
        "fill-extrusion-height":["get","height"],
        "fill-extrusion-opacity":0.92,
        "fill-extrusion-vertical-gradient": true
      }
    });

    map.addSource("district-labels", {type:"geojson", data:labels});
    map.addLayer({
      id:"district-labels-layer",
      type:"symbol",
      source:"district-labels",
      layout:{
        "text-field":["concat","District ",["get","district"]],
        "text-font":["Open Sans Bold","Arial Unicode MS Bold"],
        "text-size":13,
        "text-offset":[0,1.6],
        "text-anchor":"bottom"
      },
      paint:{
        "text-color":"#111",
        "text-halo-color":"#fff",
        "text-halo-width":1.4
      }
    });

    // Store symbols (weighted centroids)
    
    map.setLight({
      anchor:"viewport",
      color:"#ffffff",
      intensity:0.75,
      position:[1.5, 180, 80]
    });
    // --- STORES SOURCE (make sure 'stores' GeoJSON exists) ---
map.addSource("stores", { type: "geojson", data: stores });

// --- Inline SVG icons (no external URLs) ---
const svgIcons = {
  "marker-blue": 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" x="0" y="0" viewBox="0 0 380.721 380.721" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M190.372 29.813c-88.673 0-160.546 71.873-160.546 160.547 0 63.891 37.418 118.894 91.445 144.734l5.025-97.098s-9.452-3.102-11.521-4.112c-20.048-8.831-34.612-34.833-34.612-68.58 0-36.825 28.559-68.544 56.17-68.806H136.437c27.617.261 56.177 31.98 56.177 68.806 0 33.747-14.582 59.738-34.589 68.58-.157.069-11.613 4.229-11.613 4.229l5.612 107.961c12.315 3.031 25.119 4.81 38.37 4.81 17.87 0 34.984-3.044 51.041-8.424l4.973-96.214c-13.105-2.882-24.283-11.225-31.289-21.692-8.679-13.001 6.681-128.067 6.681-128.067h9.992v107.978h9.923V96.499h10.852v107.99h9.876V96.499h11.259v107.99h9.91V96.499h7.668s15.36 115.066 6.67 128.067c-6.937 10.364-18.01 18.683-30.952 21.634-.232.082-.442.162-.442.162l4.322 82.761c47.823-27.804 80.053-79.46 80.053-138.762-.024-88.674-71.897-160.548-160.559-160.548z" fill="#c90b0b" opacity="1" data-original="#000000" class=""></path><path d="M103.662 148.98c.575-2.341 1.348-4.566 1.383-4.606.25-.877-.215-1.772-1.168-2.341-.906-.488-2.01-.238-2.521.546 0 0-1.098 1.749-2.69 4.334-1.295 2.225-3.212 5.78-4.52 10.207-1.133 3.88-2.486 9.039-3.096 14.813a70.666 70.666 0 0 0-.227 8.586c.227 3.212.714 5.96 1.644 9.103 3.154 8.964 5.583 17.644 14.349 26.206 2.771 2.847 5.618 4.787 7.674 6.216l.726.511c.442.291.866.559 1.284.803 1.726.906 2.881 1.231 3.091 1.277.859.232 1.743-.186 2.108-.883.343-.732.093-1.65-.621-2.23 0 0-1-.871-2.283-2.498-.877-.988-1.83-2.417-2.939-4.031-.784-1.139-1.708-2.429-2.568-3.684-4.27-6.518-6.732-15.615-10.137-24.934-.668-2.022-1.214-4.642-1.418-6.867a70.088 70.088 0 0 1-.4-7.337c-.099-5.333.139-9.911.604-13.623.534-4.188.952-7.331 1.725-9.568z" fill="#c90b0b" opacity="1" data-original="#000000" class=""></path><path d="M190.372 0C85.415 0 0 85.397 0 190.36 0 295.3 85.415 380.721 190.372 380.721c104.952 0 190.35-85.421 190.35-190.361C380.721 85.397 295.324 0 190.372 0zm0 366.523c-97.144 0-176.18-79.03-176.18-176.163 0-97.144 79.036-176.18 176.18-176.18 97.133 0 176.175 79.036 176.175 176.18-.001 97.133-79.043 176.163-176.175 176.163z" fill="#c90b0b" opacity="1" data-original="#000000" class=""></path></g></svg>'
  ),
  "marker-green": 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" x="0" y="0" viewBox="0 0 380.721 380.721" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M190.372 29.813c-88.673 0-160.546 71.873-160.546 160.547 0 63.891 37.418 118.894 91.445 144.734l5.025-97.098s-9.452-3.102-11.521-4.112c-20.048-8.831-34.612-34.833-34.612-68.58 0-36.825 28.559-68.544 56.17-68.806H136.437c27.617.261 56.177 31.98 56.177 68.806 0 33.747-14.582 59.738-34.589 68.58-.157.069-11.613 4.229-11.613 4.229l5.612 107.961c12.315 3.031 25.119 4.81 38.37 4.81 17.87 0 34.984-3.044 51.041-8.424l4.973-96.214c-13.105-2.882-24.283-11.225-31.289-21.692-8.679-13.001 6.681-128.067 6.681-128.067h9.992v107.978h9.923V96.499h10.852v107.99h9.876V96.499h11.259v107.99h9.91V96.499h7.668s15.36 115.066 6.67 128.067c-6.937 10.364-18.01 18.683-30.952 21.634-.232.082-.442.162-.442.162l4.322 82.761c47.823-27.804 80.053-79.46 80.053-138.762-.024-88.674-71.897-160.548-160.559-160.548z" fill="#107710" opacity="1" data-original="#000000" class=""></path><path d="M103.662 148.98c.575-2.341 1.348-4.566 1.383-4.606.25-.877-.215-1.772-1.168-2.341-.906-.488-2.01-.238-2.521.546 0 0-1.098 1.749-2.69 4.334-1.295 2.225-3.212 5.78-4.52 10.207-1.133 3.88-2.486 9.039-3.096 14.813a70.666 70.666 0 0 0-.227 8.586c.227 3.212.714 5.96 1.644 9.103 3.154 8.964 5.583 17.644 14.349 26.206 2.771 2.847 5.618 4.787 7.674 6.216l.726.511c.442.291.866.559 1.284.803 1.726.906 2.881 1.231 3.091 1.277.859.232 1.743-.186 2.108-.883.343-.732.093-1.65-.621-2.23 0 0-1-.871-2.283-2.498-.877-.988-1.83-2.417-2.939-4.031-.784-1.139-1.708-2.429-2.568-3.684-4.27-6.518-6.732-15.615-10.137-24.934-.668-2.022-1.214-4.642-1.418-6.867a70.088 70.088 0 0 1-.4-7.337c-.099-5.333.139-9.911.604-13.623.534-4.188.952-7.331 1.725-9.568z" fill="#107710" opacity="1" data-original="#000000" class=""></path><path d="M190.372 0C85.415 0 0 85.397 0 190.36 0 295.3 85.415 380.721 190.372 380.721c104.952 0 190.35-85.421 190.35-190.361C380.721 85.397 295.324 0 190.372 0zm0 366.523c-97.144 0-176.18-79.03-176.18-176.163 0-97.144 79.036-176.18 176.18-176.18 97.133 0 176.175 79.036 176.175 176.18-.001 97.133-79.043 176.163-176.175 176.163z" fill="#107710" opacity="1" data-original="#000000" class=""></path></g></svg>'
  ),
  "marker-orange": 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" x="0" y="0" viewBox="0 0 380.721 380.721" style="enable-background:new 0 0 512 512" xml:space="preserve" class=""><g><path d="M190.372 29.813c-88.673 0-160.546 71.873-160.546 160.547 0 63.891 37.418 118.894 91.445 144.734l5.025-97.098s-9.452-3.102-11.521-4.112c-20.048-8.831-34.612-34.833-34.612-68.58 0-36.825 28.559-68.544 56.17-68.806H136.437c27.617.261 56.177 31.98 56.177 68.806 0 33.747-14.582 59.738-34.589 68.58-.157.069-11.613 4.229-11.613 4.229l5.612 107.961c12.315 3.031 25.119 4.81 38.37 4.81 17.87 0 34.984-3.044 51.041-8.424l4.973-96.214c-13.105-2.882-24.283-11.225-31.289-21.692-8.679-13.001 6.681-128.067 6.681-128.067h9.992v107.978h9.923V96.499h10.852v107.99h9.876V96.499h11.259v107.99h9.91V96.499h7.668s15.36 115.066 6.67 128.067c-6.937 10.364-18.01 18.683-30.952 21.634-.232.082-.442.162-.442.162l4.322 82.761c47.823-27.804 80.053-79.46 80.053-138.762-.024-88.674-71.897-160.548-160.559-160.548z" fill="#ff7f0e" opacity="1" data-original="#000000" class=""></path><path d="M103.662 148.98c.575-2.341 1.348-4.566 1.383-4.606.25-.877-.215-1.772-1.168-2.341-.906-.488-2.01-.238-2.521.546 0 0-1.098 1.749-2.69 4.334-1.295 2.225-3.212 5.78-4.52 10.207-1.133 3.88-2.486 9.039-3.096 14.813a70.666 70.666 0 0 0-.227 8.586c.227 3.212.714 5.96 1.644 9.103 3.154 8.964 5.583 17.644 14.349 26.206 2.771 2.847 5.618 4.787 7.674 6.216l.726.511c.442.291.866.559 1.284.803 1.726.906 2.881 1.231 3.091 1.277.859.232 1.743-.186 2.108-.883.343-.732.093-1.65-.621-2.23 0 0-1-.871-2.283-2.498-.877-.988-1.83-2.417-2.939-4.031-.784-1.139-1.708-2.429-2.568-3.684-4.27-6.518-6.732-15.615-10.137-24.934-.668-2.022-1.214-4.642-1.418-6.867a70.088 70.088 0 0 1-.4-7.337c-.099-5.333.139-9.911.604-13.623.534-4.188.952-7.331 1.725-9.568z" fill="#ff7f0e" opacity="1" data-original="#000000" class=""></path><path d="M190.372 0C85.415 0 0 85.397 0 190.36 0 295.3 85.415 380.721 190.372 380.721c104.952 0 190.35-85.421 190.35-190.361C380.721 85.397 295.324 0 190.372 0zm0 366.523c-97.144 0-176.18-79.03-176.18-176.163 0-97.144 79.036-176.18 176.18-176.18 97.133 0 176.175 79.036 176.175 176.18-.001 97.133-79.043 176.163-176.175 176.163z" fill="#ff7f0e" opacity="1" data-original="#000000" class=""></path></g></svg>'
  )
};

// --- Load images, then add the layer when all are ready ---
const iconNames = Object.keys(svgIcons);
let loaded = 0;

function addStoresLayer() {
  if (map.getLayer("stores-symbols")) return; // avoid duplicates
  map.addLayer({
    id: "stores-symbols",
    type: "symbol",
    source: "stores",
    layout: {
      "icon-image": [
        "match",
        ["get", "branch"],
        "D2", "marker-blue",
        "D10", "marker-green",
        "D14", "marker-orange",
        "marker-blue"               // fallback
      ],
      "icon-size": 1.8,             // tweak if you want larger pins
      "icon-anchor": "bottom",
      "icon-allow-overlap": true,
      "text-field": ["get", "label"],
      "text-font": ["Open Sans Bold", "Arial Unicode MS Bold"],
      "text-size": 12,
      "text-offset": [0, 1.2],
      "text-anchor": "top",
      "text-optional": true
    },
    paint: {
      "text-color": "#111",
      "text-halo-color": "#fff",
      "text-halo-width": 1.4
    }
  });

  // Optional popup for stores
  const popup = new mapboxgl.Popup({ closeButton: false, closeOnClick: true });
  map.on("mousemove", "stores-symbols", (e) => {
    const f = e.features && e.features[0];
    if (!f) return;
    const p = f.properties;
    popup.setLngLat(e.lngLat)
      .setHTML(`<strong>${p.label}</strong><br>Total demand: ${p.total_demand}`)
      .addTo(map);
  });
  map.on("mouseleave", "stores-symbols", () => popup.remove());
}

// Add images (after style load), then add layer
iconNames.forEach((name) => {
  const img = new Image(28, 28);
  img.onload = () => {
    if (!map.hasImage(name)) map.addImage(name, img, { pixelRatio: 2 });
    loaded += 1;
    if (loaded === iconNames.length) addStoresLayer();
  };
  img.onerror = (e) => console.error("Icon load error:", name, e);
  img.src = svgIcons[name];
});

    const popup = new mapboxgl.Popup({closeButton:false, closeOnClick:true});
    map.on("mousemove","pillars-layer",(e)=>{
      const f = e.features && e.features[0];
      if(!f) return;
      const p = f.properties;
      popup.setLngLat(e.lngLat)
           .setHTML(`<strong>District ${p.district}</strong><br>Branch: ${p.branch}<br>Demand: ${p.demand}`)
           .addTo(map);
    });
    map.on("mouseleave","pillars-layer",()=>popup.remove());
  });
</script>
</body>
</html>
